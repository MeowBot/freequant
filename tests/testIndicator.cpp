#include <iostream>
#include <boost/test/unit_test.hpp>

#include <freequant/indicators/SMA.h>

#include <freequant/experiment/MA.h>
#include <freequant/experiment/RSI.h>

const char *msft[7][] = {
    "Date","Open","High","Low","Close","Volume","Adjusted",
    "2012-01-02",26.55,26.96,26.39,26.77,64731500,26.03,
    "2012-01-03",26.82,27.47,26.78,27.4,80516100,26.65,
    "2012-01-04",27.38,27.73,27.29,27.68,56081400,26.92,
    "2012-01-05",27.53,28.19,27.53,28.11,99455500,27.34,
    "2012-01-08",28.05,28.1,27.72,27.74,59706800,26.98,
    "2012-01-09",27.93,28.15,27.75,27.84,60014400,27.07,
    "2012-01-10",27.43,27.98,27.37,27.72,65582400,26.96,
    "2012-01-11",27.87,28.02,27.65,28,49370800,27.23,
    "2012-01-12",27.93,28.25,27.79,28.25,60196100,27.47,
    "2012-01-16",28.4,28.65,28.17,28.26,72395300,27.48,
    "2012-01-17",28.31,28.4,27.97,28.23,64860600,27.45,
    "2012-01-18",28.16,28.44,28.03,28.12,74053500,27.35,
    "2012-01-19",28.82,29.74,28.75,29.71,165902900,28.89,
    "2012-01-22",29.55,29.95,29.35,29.73,76078100,28.91,
    "2012-01-23",29.47,29.57,29.18,29.34,51703300,28.53,
    "2012-01-24",29.07,29.65,29.07,29.56,59231700,28.75,
    "2012-01-25",29.61,29.7,29.4,29.5,49102800,28.69,
    "2012-01-26",29.45,29.53,29.17,29.23,44187700,28.43,
    "2012-01-29",28.97,29.62,28.83,29.61,51114800,28.8,
    "2012-01-30",29.66,29.7,29.23,29.53,50572400,28.72,
    "2012-01-31",29.79,30.05,29.76,29.89,67409900,29.07,
    "2012-02-01",29.9,30.17,29.71,29.95,52223300,29.13,
    "2012-02-02",30.14,30.4,30.09,30.24,41838500,29.41,
    "2012-02-05",30.04,30.22,29.97,30.2,28039700,29.37,
    "2012-02-06",30.15,30.49,30.05,30.35,39242400,29.52,
    "2012-02-07",30.26,30.67,30.22,30.66,49659100,29.82,
    "2012-02-08",30.68,30.8,30.48,30.77,50481600,29.92,
    "2012-02-09",30.64,30.8,30.36,30.5,44605300,29.66,
    "2012-02-12",30.63,30.77,30.43,30.58,33319800,29.74,
    "2012-02-13",30.33,30.46,29.85,30.25,59644000,29.61,
    "2012-02-14",30.33,30.39,30.03,30.05,43311300,29.42,
    "2012-02-15",30.31,31.55,30.3,31.29,94705100,30.63,
    "2012-02-16",31.2,31.32,30.95,31.25,70036500,30.59,
    "2012-02-20",31.18,31.61,31.15,31.44,50829900,30.78,
    "2012-02-21",31.45,31.68,31.18,31.27,49253200,30.61,
    "2012-02-22",31.2,31.59,31,31.37,35034700,30.71,
    "2012-02-23",31.48,31.5,31.24,31.48,35575400,30.82,
    "2012-02-26",31.24,31.5,31.1,31.35,34568400,30.69,
    "2012-02-27",31.41,31.93,31.38,31.87,45230600,31.2,
    "2012-02-28",31.89,32,31.61,31.74,59323600,31.07,
    "2012-02-29",31.93,32.39,31.85,32.29,77344100,31.61,
    "2012-03-01",32.31,32.44,32,32.08,47314200,31.4,
    "2012-03-04",32.01,32.05,31.62,31.8,45240000,31.13,
    "2012-03-05",31.54,31.98,31.49,31.56,51932900,30.89,
    "2012-03-06",31.67,31.92,31.53,31.84,34340400,31.17,
    "2012-03-07",32.04,32.21,31.9,32.01,36747400,31.33,
    "2012-03-08",32.1,32.16,31.92,31.99,34628400,31.31,
    "2012-03-11",31.97,32.2,31.82,32.04,34073600,31.36,
    "2012-03-12",32.24,32.69,32.15,32.67,48951700,31.98,
    "2012-03-13",32.53,32.88,32.49,32.77,41986900,32.08,
    "2012-03-14",32.79,32.94,32.58,32.85,49068300,32.16,
    "2012-03-15",32.91,32.95,32.5,32.6,65626400,31.91,
    "2012-03-18",32.54,32.61,32.15,32.2,44789200,31.52,
    "2012-03-19",32.1,32.15,31.74,31.99,41566800,31.31,
    "2012-03-20",31.96,32.15,31.82,31.91,37928600,31.24,
    "2012-03-21",31.81,32.09,31.79,32,31749500,31.32,
    "2012-03-22",32.1,32.11,31.72,32.01,35912200,31.33,
    "2012-03-25",32.19,32.61,32.15,32.59,36758300,31.9,
    "2012-03-26",32.65,32.7,32.4,32.52,36274900,31.83,
    "2012-03-27",32.52,32.7,32.04,32.19,41344800,31.51,
    "2012-03-28",32.06,32.19,31.81,32.12,37038500,31.44,
    "2012-03-29",32.4,32.41,32.04,32.26,31749400,31.58
};

BOOST_AUTO_TEST_CASE(Indicators) {
    FreeQuant::SMA<5> sma;
    sma.append(19);
    sma.append(19);
    sma.append(19);
    sma.append(19);
    sma.append(19);

    FreeQuant::Exp::RSI rsi;
    FreeQuant::Exp::MA ma(4);
    ma.add(1);
    ma.add(2);
    ma.add(3);
    ma.add(6);
    ma.add(4);
    ma.add(8);
    ma.add(6);
    BOOST_CHECK_CLOSE(ma.last(1), 6.0, 1e-6);
    BOOST_CHECK_CLOSE(ma.last(2), 5.25, 1e-6);

}

BOOST_AUTO_TEST_CASE(DispatchIndicators) {


}
