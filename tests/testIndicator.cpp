#include <iostream>
#include <boost/test/unit_test.hpp>

#include <freequant/indicators/SMA.h>

#include <freequant/experiment/MA.h>
#include <freequant/experiment/RSI.h>

const char *msft[][19] = {
    "Date","MSFT.Open","MSFT.High","MSFT.Low","MSFT.Close","MSFT.Volume","MSFT.Adjusted","sma","ema","tr","atr","trueHigh","trueLow","macd","signal","dn","mavg","up","pctB",
    "2012-01-01","26.550","26.960","26.390","26.770","64731500.000","26.030","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA",
    "2012-01-02","26.820","27.470","26.780","27.400","80516100.000","26.650","NA","NA","0.430","NA","26.820","26.390","NA","NA","NA","NA","NA","NA",
    "2012-01-03","27.380","27.730","27.290","27.680","56081400.000","26.920","NA","NA","0.600","NA","27.380","26.780","NA","NA","NA","NA","NA","NA",
    "2012-01-04","27.530","28.190","27.530","28.110","99455500.000","27.340","NA","NA","0.240","NA","27.530","27.290","NA","NA","NA","NA","NA","NA",
    "2012-01-07","28.050","28.100","27.720","27.740","59706800.000","26.980","NA","NA","0.520","NA","28.050","27.530","NA","NA","NA","NA","NA","NA",
    "2012-01-08","27.930","28.150","27.750","27.840","60014400.000","27.070","NA","NA","0.210","NA","27.930","27.720","NA","NA","NA","NA","NA","NA",
    "2012-01-09","27.430","27.980","27.370","27.720","65582400.000","26.960","NA","NA","0.000","NA","27.750","27.750","NA","NA","NA","NA","NA","NA",
    "2012-01-10","27.870","28.020","27.650","28.000","49370800.000","27.230","NA","NA","0.500","NA","27.870","27.370","NA","NA","NA","NA","NA","NA",
    "2012-01-11","27.930","28.250","27.790","28.250","60196100.000","27.470","NA","NA","0.280","NA","27.930","27.650","NA","NA","NA","NA","NA","NA",
    "2012-01-15","28.400","28.650","28.170","28.260","72395300.000","27.480","27.777","27.777","0.610","NA","28.400","27.790","NA","NA","NA","NA","NA","NA",
    "2012-01-16","28.310","28.400","27.970","28.230","64860600.000","27.450","27.923","27.859","0.140","NA","28.310","28.170","NA","NA","NA","NA","NA","NA",
    "2012-01-17","28.160","28.440","28.030","28.120","74053500.000","27.350","27.995","27.907","0.190","NA","28.160","27.970","NA","NA","NA","NA","NA","NA",
    "2012-01-18","28.820","29.740","28.750","29.710","165902900.000","28.890","28.198","28.235","0.790","NA","28.820","28.030","NA","NA","NA","NA","NA","NA",
    "2012-01-21","29.550","29.950","29.350","29.730","76078100.000","28.910","28.360","28.507","0.800","NA","29.550","28.750","NA","NA","NA","NA","NA","NA",
    "2012-01-22","29.470","29.570","29.180","29.340","51703300.000","28.530","28.520","28.658","0.120","0.388","29.470","29.350","NA","NA","NA","NA","NA","NA",
    "2012-01-23","29.070","29.650","29.070","29.560","59231700.000","28.750","28.692","28.822","0.000","0.360","29.180","29.180","NA","NA","NA","NA","NA","NA",
    "2012-01-24","29.610","29.700","29.400","29.500","49102800.000","28.690","28.870","28.945","0.540","0.373","29.610","29.070","NA","NA","NA","NA","NA","NA",
    "2012-01-25","29.450","29.530","29.170","29.230","44187700.000","28.430","28.993","28.997","0.050","0.350","29.450","29.400","NA","NA","NA","NA","NA","NA",
    "2012-01-28","28.970","29.620","28.830","29.610","51114800.000","28.800","29.129","29.109","0.000","0.325","29.170","29.170","NA","NA","NA","NA","NA","NA",
    "2012-01-29","29.660","29.700","29.230","29.530","50572400.000","28.720","29.256","29.185","0.830","0.361","29.660","28.830","NA","NA","26.705","28.459","30.214","0.793",
    "2012-01-30","29.790","30.050","29.760","29.890","67409900.000","29.070","29.422","29.313","0.560","0.375","29.790","29.230","NA","NA","26.952","28.619","30.285","0.884",
    "2012-01-31","29.900","30.170","29.710","29.950","52223300.000","29.130","29.605","29.429","0.140","0.358","29.900","29.760","NA","NA","27.124","28.755","30.386","0.864",
    "2012-02-01","30.140","30.400","30.090","30.240","41838500.000","29.410","29.658","29.577","0.430","0.364","30.140","29.710","NA","NA","27.231","28.889","30.547","0.908",
    "2012-02-04","30.040","30.220","29.970","30.200","28039700.000","29.370","29.705","29.690","0.000","0.338","30.090","30.090","NA","NA","27.316","28.998","30.681","0.836",
    "2012-02-05","30.150","30.490","30.050","30.350","39242400.000","29.520","29.806","29.810","0.180","0.326","30.150","29.970","NA","NA","27.434","29.120","30.807","0.849",
    "2012-02-06","30.260","30.670","30.220","30.660","49659100.000","29.820","29.916","29.964","0.210","0.318","30.260","30.050","3.198","NA","27.555","29.251","30.947","0.873",
    "2012-02-07","30.680","30.800","30.480","30.770","50481600.000","29.920","30.043","30.111","0.460","0.328","30.680","30.220","3.228","NA","27.754","29.400","31.047","0.890",
    "2012-02-08","30.640","30.800","30.360","30.500","44605300.000","29.660","30.170","30.182","0.160","0.316","30.640","30.480","3.202","NA","27.969","29.533","31.098","0.826",
    "2012-02-11","30.630","30.770","30.430","30.580","33319800.000","29.740","30.267","30.254","0.270","0.313","30.630","30.360","3.141","NA","28.176","29.658","31.141","0.815",
    "2012-02-12","30.330","30.460","29.850","30.250","59644000.000","29.610","30.339","30.253","0.000","0.290","30.430","30.430","2.976","NA","28.377","29.750","31.122","0.659",
    "2012-02-13","30.330","30.390","30.030","30.050","43311300.000","29.420","30.355","30.216","0.480","0.304","30.330","29.850","2.813","NA","28.665","29.847","31.030","0.631",
    "2012-02-14","30.310","31.550","30.300","31.290","94705100.000","30.630","30.489","30.412","0.280","0.302","30.310","30.030","2.647","NA","28.961","29.990","31.019","1.013",
    "2012-02-15","31.200","31.320","30.950","31.250","70036500.000","30.590","30.590","30.564","0.900","0.345","31.200","30.300","2.722","NA","28.966","30.079","31.191","0.992",
    "2012-02-19","31.180","31.610","31.150","31.440","50829900.000","30.780","30.714","30.723","0.230","0.337","31.180","30.950","2.742","2.963","28.930","30.165","31.400","1.000",
    "2012-02-20","31.450","31.680","31.180","31.270","49253200.000","30.610","30.806","30.823","0.300","0.334","31.450","31.150","2.796","2.930","28.981","30.265","31.550","0.933",
    "2012-02-21","31.200","31.590","31.000","31.370","35034700.000","30.710","30.877","30.922","0.020","0.312","31.200","31.180","2.739","2.891","29.058","30.360","31.662","0.869",
    "2012-02-22","31.480","31.500","31.240","31.480","35575400.000","30.820","30.948","31.024","0.480","0.324","31.480","31.000","2.734","2.860","29.134","30.454","31.774","0.861",
    "2012-02-25","31.240","31.500","31.100","31.350","34568400.000","30.690","31.033","31.083","0.000","0.301","31.240","31.240","2.636","2.815","29.293","30.554","31.815","0.802",
    "2012-02-26","31.410","31.930","31.380","31.870","45230600.000","31.200","31.162","31.226","0.310","0.301","31.410","31.100","2.573","2.767","29.440","30.673","31.906","0.927",
    "2012-02-27","31.890","32.000","31.610","31.740","59323600.000","31.070","31.311","31.320","0.510","0.316","31.890","31.380","2.616","2.737","29.591","30.788","31.985","0.916",
    "2012-02-28","31.930","32.390","31.850","32.290","77344100.000","31.610","31.535","31.496","0.320","0.316","31.930","31.610","2.629","2.715","29.633","30.901","32.170","1.003",
    "2012-02-29","32.310","32.440","32.000","32.080","47314200.000","31.400","31.614","31.602","0.460","0.327","32.310","31.850","2.705","2.713","29.709","31.013","32.317","0.945",
    "2012-03-03","32.010","32.050","31.620","31.800","45240000.000","31.130","31.669","31.638","0.010","0.304","32.010","32.000","2.655","2.701","29.793","31.092","32.391","0.782",
    "2012-03-04","31.540","31.980","31.490","31.560","51932900.000","30.890","31.681","31.624","0.000","0.282","31.620","31.620","2.465","2.654","29.926","31.169","32.413","0.704",
    "2012-03-05","31.670","31.920","31.530","31.840","34340400.000","31.170","31.738","31.663","0.180","0.275","31.670","31.490","2.322","2.588","30.041","31.243","32.444","0.717",
    "2012-03-06","32.040","32.210","31.900","32.010","36747400.000","31.330","31.802","31.726","0.510","0.292","32.040","31.530","2.276","2.525","30.118","31.319","32.520","0.800",
    "2012-03-07","32.100","32.160","31.920","31.990","34628400.000","31.310","31.853","31.774","0.200","0.285","32.100","31.900","2.229","2.466","30.185","31.386","32.587","0.765",
    "2012-03-10","31.970","32.200","31.820","32.040","34073600.000","31.360","31.922","31.823","0.050","0.268","31.970","31.920","2.133","2.400","30.292","31.459","32.627","0.740",
    "2012-03-11","32.240","32.690","32.150","32.670","48951700.000","31.980","32.002","31.977","0.420","0.279","32.240","31.820","2.102","2.340","30.374","31.555","32.736","0.902",
    "2012-03-12","32.530","32.880","32.490","32.770","41986900.000","32.080","32.105","32.121","0.380","0.286","32.530","32.150","2.125","2.297","30.574","31.681","32.788","0.966",
    "2012-03-13","32.790","32.940","32.580","32.850","49068300.000","32.160","32.161","32.253","0.300","0.287","32.790","32.490","2.182","2.274","30.845","31.813","32.781","1.005",
    "2012-03-14","32.910","32.950","32.500","32.600","65626400.000","31.910","32.213","32.316","0.330","0.290","32.910","32.580","2.231","2.265","30.923","31.894","32.866","0.906",
    "2012-03-17","32.540","32.610","32.150","32.200","44789200.000","31.520","32.253","32.295","0.040","0.273","32.540","32.500","2.151","2.243","31.023","31.952","32.881","0.698",
    "2012-03-18","32.100","32.150","31.740","31.990","41566800.000","31.310","32.296","32.240","0.000","0.253","32.150","32.150","1.954","2.185","31.086","31.980","32.874","0.489",
    "2012-03-19","31.960","32.150","31.820","31.910","37928600.000","31.240","32.303","32.180","0.220","0.251","31.960","31.740","1.743","2.097","31.159","32.009","32.859","0.471",
    "2012-03-20","31.810","32.090","31.790","32.000","31749500.000","31.320","32.302","32.147","0.000","0.233","31.820","31.820","1.521","1.981","31.251","32.041","32.831","0.449",
    "2012-03-21","32.100","32.110","31.720","32.010","35912200.000","31.330","32.304","32.122","0.310","0.238","32.100","31.790","1.402","1.865","31.331","32.068","32.805","0.418",
    "2012-03-24","32.190","32.610","32.150","32.590","36758300.000","31.900","32.359","32.207","0.470","0.255","32.190","31.720","1.314","1.755","31.457","32.125","32.793","0.743",
    "2012-03-25","32.650","32.700","32.400","32.520","36274900.000","31.830","32.344","32.264","0.500","0.272","32.650","32.150","1.345","1.673","31.500","32.165","32.831","0.782",
    "2012-03-26","32.520","32.700","32.040","32.190","41344800.000","31.510","32.286","32.251","0.120","0.262","32.520","32.400","1.321","1.603","31.548","32.192","32.836","0.592",
    "2012-03-27","32.060","32.190","31.810","32.120","37038500.000","31.440","32.213","32.227","0.020","0.244","32.060","32.040","1.174","1.517","31.537","32.185","32.832","0.388",
    "2012-03-28","32.400","32.410","32.040","32.260","31749400.000","31.580","32.179","32.233","0.590","0.269","32.400","31.810","1.129","1.439","31.540","32.188","32.836","0.538",
};

BOOST_AUTO_TEST_CASE(Indicators) {
    FreeQuant::SMA<5> sma;
    sma.append(19);
    sma.append(19);
    sma.append(19);
    sma.append(19);
    sma.append(19);

    FreeQuant::Exp::RSI rsi;
    FreeQuant::Exp::MA ma(4);
    ma.add(1);
    ma.add(2);
    ma.add(3);
    ma.add(6);
    ma.add(4);
    ma.add(8);
    ma.add(6);
    BOOST_CHECK_CLOSE(ma.last(1), 6.0, 1e-6);
    BOOST_CHECK_CLOSE(ma.last(2), 5.25, 1e-6);

}

BOOST_AUTO_TEST_CASE(DispatchIndicators) {


}
